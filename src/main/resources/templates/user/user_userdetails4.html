<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&family=Roboto:wght@100;300;400;500;700;900&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" href="/asset/css/user_usedetails.css">
    <link rel="stylesheet" href="/asset/css/header.css">
    <link rel="stylesheet" href="/asset/css/footer.css">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        /*서비스 신청 목록 네비게이션*/
        .menu03, .menu04{
            display: none!important;
    </style>
</head>
<body>
<header th:replace="header.html"></header>
<div class="sub_page_wrap">
    <!-- sub_title_wrap -->
    <div class="sub_title_wrap title_only">

        <div class="sub_title">
            <p>서비스 이용 내역</p>
            <p th:text="|${session.userVO.userName}님의 서비스 이용 내역입니다.|"></p>
        </div>

    </div>

    <div class="common_content_wrap">
        <!--<div class="form_sub_tab column">
            <ul class="tab">
                &lt;!&ndash; <li id="all" >전체</li> &ndash;&gt;
                <li id="match" onclick="location.href='/user/user_userdetails'"><span>배정요청</span><em th:text="*{totallist1}+*{totallist5}"></em></li>
                <li id="reserv" onclick="location.href='/user/user_userdetails2'"><span>예약</span><em th:text="*{totallist2}+*{totallist6}" ></em></li>
                <li id="proc" onclick="location.href='/user/user_userdetails3'"><span>서비스중</span><em th:text="*{totallist3}+*{totallist7}"></em></li>
                &lt;!&ndash;<li id="end" class="current" onclick="location.href='/user/user_userdetails4'"><span>종료</span><em>0</em></li>
                &ndash;&gt;
                <li id="end" class="current"><span>종료</span><em th:text="*{totallist4}+*{totallist8}"></em></li>

            </ul>
        </div>-->
        <div class="form_sub_tab column">
            <ul class="tab">
                <!-- <li id="all" >전체</li> -->
                <li id="match" onclick="location.href='/user/user_userdetails'"><span>배정요청</span><em th:text="*{totallist1}"></em></li>
                <li id="reserv" onclick="location.href='/user/user_userdetails2'"><span>예약</span><em th:text="*{totallist2}" ></em></li>
                <li id="proc" onclick="location.href='/user/user_userdetails3'"><span>서비스중</span><em th:text="*{totallist3}"></em></li>
                <!--<li id="end" class="current" onclick="location.href='/user/user_userdetails4'"><span>종료</span><em>0</em></li>
                -->
                <li id="end" class="current"><span>종료</span><em th:text="*{totallist4}"></em></li>

            </ul>
        </div>
        <!-- 종료 -->
        <div class="com_accordion serviceEnd">
            <ul>
                <li class="history" th:each="acc:${accDTO}">
                    <div class="ac_title" th:object="${acc}">

                        <p class="service_a">동행서비스</p>
                        <div class="left_con">
                            <p>
                                <span class="title">이용자</span>
                                <span th:text="*{accReservationName}"></span>
                            </p>
                            <p>
                                <span class="title">이용일시</span>
                                <span th:text="*{accReservationDate}"></span>
                                <span th:text="|*{accReservationTime}시간|"></span>
                            </p>
                        </div>
                        <p class="photo">
                        </p>
                        <div class="left_con endmanager">
                            <p>
                                <span class="title">매니저 이름</span>
                                <span th:text="*{managerName}"></span>
                            </p>
                            <p>
                                <span class="title">연락처</span>
                                <span th:text="*{managerPhoneNum}"><br></span>
                            </p>
                            <a class="importPayment accept" th:id="*{accReservationNum}" th:name="*{accReservationType}">결제하기</a>
                            <input type="text" style="display: none;" th:href="*{accReservationPrice}" th:name="*{accReservationName}" th:id="*{accReservationPhoneNum}">
                        </div>
                    </div>
                </li>

                <li class="history" th:each="care:${careDTO}">
                    <div class="ac_title" th:object="${care}">

                        <p class="service_b">돌봄서비스</p>
                        <div class="left_con">
                            <p>
                                <span class="title">이용자</span>
                                <span th:text="*{careReservationName}"></span>
                            </p>
                            <p>
                                <span class="title">이용일시</span>
                                <span th:text="*{careReservationDate}"></span>
                                <span th:text="|*{careReservationTime} 시간|"></span>
                            </p>
                        </div>
                        <p class="photo">
                        </p>
                        <div class="left_con endmanager">
                            <p>
                                <span class="title">매니저 이름</span>
                                <span th:text="*{managerName}"></span>
                            </p>
                            <p>
                                <span class="title">연락처</span>
                                <span th:text="*{managerPhoneNum}"><br></span>
                                <a class="importPayment accept" th:id="*{careReservationNum}"  th:name="*{careReservationType}" >결제하기</a>
                                <input type="text" style="display: none;" th:href="*{careReservationPrice}" th:name="*{careReservationName}" th:id="*{careReservationPhoneNum}">
                            </p>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>


</div>
<div style="text-align: center">
    <a class="changePage" th:if="${pageDTO.prev}" th:href="${pageDTO.startPage - 1}"><code>&lt;</code></a>
    <th:block th:each="num:${#numbers.sequence(pageDTO.startPage, pageDTO.endPage)}">
        <code th:text="${num}" th:if="${pageDTO.criteria.pageNum == num}"></code>
        <a class="changePage" th:unless="${pageDTO.criteria.pageNum == num}" th:href="${num}"><code th:text="${num}"></code></a>
    </th:block>
    <a class="changePage" th:if="${pageDTO.next}" th:href="${pageDTO.endPage + 1}"><code>&gt;</code></a>
</div>
<form action="/user/user_userdetailds4" th:object="${criteria}" name="pageForm">
    <input type="hidden" th:field="*{pageNum}">
    <input type="hidden" th:field="*{amount}">
</form>
<footer th:replace="footer.html"></footer>
</body>
</html>
<!-- 제이쿼리 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous" type="text/javascript"></script>
<!-- 아임포트 -->
<script src ="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js" type="text/javascript"></script>
<script>


    // 카카오결제
    $(document).ready(function () {
        $(".importPayment").click(function () {
            console.log("들어옴")
            let price = $(this).next().attr("href");
            let types = $(this).attr("name") + "(" +price.substring(0,1) + "시간)";
            let number = $(this).prop("id")
            let named = $(this).next().attr("name")
            let phoneNum = $(this).next().attr("id")
            payment(price, types, number, named, phoneNum); //버튼 클릭시 호출
        })
    })



    //   버튼 클릭 시 실행
    function payment(price, types, number, named, phoneNum){

        var IMP = window.IMP; // 생략 가능
        IMP.init('imp31759373');
        IMP.request_pay({
            pg: "kakaopay.TC0ONETIME",
            pay_method: "card",
            merchant_uid: number,
            name: types,
            amount: price,
            buyer_email: "testiampoart@naver.com",
            buyer_name: named,
            buyer_tel: phoneNum
        }, function(rsp){ //callback함수
            if(rsp.success){
                alert("결제 완료");
            }else{
                alert("실패 : 코드("+rsp.error_code+") / 메세지("+rsp.error_msg +")");
            }
        });
    }
</script>